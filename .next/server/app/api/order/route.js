(()=>{var e={};e.id=6078,e.ids=[6078],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8704:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{HTTPAccessErrorStatus:function(){return r},HTTP_ERROR_FALLBACK_ERROR_CODE:function(){return s},getAccessFallbackErrorTypeByStatus:function(){return a},getAccessFallbackHTTPStatus:function(){return u},isHTTPAccessFallbackError:function(){return o}});let r={NOT_FOUND:404,FORBIDDEN:403,UNAUTHORIZED:401},n=new Set(Object.values(r)),s="NEXT_HTTP_ERROR_FALLBACK";function o(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let[t,r]=e.digest.split(";");return t===s&&n.has(Number(r))}function u(e){return Number(e.digest.split(";")[1])}function a(e){switch(e){case 401:return"unauthorized";case 403:return"forbidden";case 404:return"not-found";default:return}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31162:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"isNextRouterError",{enumerable:!0,get:function(){return o}});let n=r(8704),s=r(49026);function o(e){return(0,s.isRedirectError)(e)||(0,n.isHTTPAccessFallbackError)(e)}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},49026:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{REDIRECT_ERROR_CODE:function(){return s},RedirectType:function(){return o},isRedirectError:function(){return u}});let n=r(52836),s="NEXT_REDIRECT";var o=function(e){return e.push="push",e.replace="replace",e}({});function u(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let t=e.digest.split(";"),[r,o]=t,u=t.slice(2,-2).join(";"),a=Number(t.at(-2));return r===s&&("replace"===o||"push"===o)&&"string"==typeof u&&!isNaN(a)&&a in n.RedirectStatusCode}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},51846:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{BailoutToCSRError:function(){return n},isBailoutToCSRError:function(){return s}});let r="BAILOUT_TO_CLIENT_SIDE_RENDERING";class n extends Error{constructor(e){super("Bail out to client-side rendering: "+e),this.reason=e,this.digest=r}}function s(e){return"object"==typeof e&&null!==e&&"digest"in e&&e.digest===r}},52637:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"isPostpone",{enumerable:!0,get:function(){return n}});let r=Symbol.for("react.postpone");function n(e){return"object"==typeof e&&null!==e&&e.$$typeof===r}},52836:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RedirectStatusCode",{enumerable:!0,get:function(){return r}});var r=function(e){return e[e.SeeOther=303]="SeeOther",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e}({});("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},55511:e=>{"use strict";e.exports=require("crypto")},56814:(e,t,r)=>{"use strict";r.d(t,{Y9:()=>l,j2:()=>p});var n=r(19443),s=r(79464),o=r(10189),u=r(85663),a=r(55511),i=r.n(a);let{handlers:l,signIn:d,signOut:c,auth:p}=(0,n.Ay)({providers:[(0,o.A)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{let t=await s.z.user.findUnique({where:{email:e.email}});if(!t||!t.password||!await (0,u.UD)(e.password,t.password))return null;return{id:t.id,email:t.email,name:t.name,role:t.role,lastLogin:new Date().toISOString()}}catch(e){return console.error("Auth error:",e),null}}})],session:{strategy:"jwt"},jwt:{maxAge:2592e3},callbacks:{async jwt({token:e,user:t,account:r,trigger:n,session:s}){if(t){let n;e.role=t.role,e.id=t.id,e.lastLogin=new Date().toISOString(),r?.userAgent&&"string"==typeof r.userAgent&&(n=r.userAgent),n&&(e.fingerprint=i().createHash("sha256").update(n).digest("hex"))}return e.exp&&Date.now()>1e3*e.exp?{...e,error:"SessionExpired"}:e},async session({session:e,token:t}){if(t.error)throw Error("Session expired");return t&&(e.user.role=t.role,e.user.id=t.id,e.user.lastLogin=t.lastLogin,e.user.fingerprint=t.fingerprint),e}},pages:{signIn:"/auth/signin"},cookies:{sessionToken:{name:"__Secure-next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0,maxAge:2592e3}},callbackUrl:{name:"__Secure-next-auth.callback-url",options:{sameSite:"lax",path:"/",secure:!0}},csrfToken:{name:"__Host-next-auth.csrf-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}}})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},76926:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return i}});let n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var a=o?Object.getOwnPropertyDescriptor(e,u):null;a&&(a.get||a.set)?Object.defineProperty(n,u,a):n[u]=e[u]}return n.default=e,r&&r.set(e,n),n}(r(61120));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}let o={current:null},u="function"==typeof n.cache?n.cache:e=>e,a=console.warn;function i(e){return function(...t){a(e(...t))}}u(e=>{try{a(o.current)}finally{o.current=null}})},78335:()=>{},79464:(e,t,r)=>{"use strict";r.d(t,{z:()=>s});var n=r(96330);let s=globalThis.prisma??new n.PrismaClient},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{},96559:(e,t,r)=>{"use strict";e.exports=r(44870)},97268:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>_,routeModule:()=>g,serverHooks:()=>j,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>b});var n={};r.r(n),r.d(n,{GET:()=>y,POST:()=>f,runtime:()=>c});var s=r(96559),o=r(48088),u=r(37719),a=r(32190),i=r(79464),l=r(56814),d=r(96330);let c="nodejs",p=new Map;async function f(e){let t=e.headers.get("x-csrf-token"),r=e.cookies.get("__Host-next-auth.csrf-token"),n=r?r.value:void 0;if(!t||!n||t!==n)return a.NextResponse.json({error:"Invalid CSRF token"},{status:403});try{let t=await (0,l.j2)();if(!t?.user?.id)return a.NextResponse.json({error:"Unauthorized"},{status:401});if(function(e){let t=Date.now(),r=p.get(e);return!r||t-r.last>6e4?(p.set(e,{count:1,last:t}),!1):r.count>=5||(r.count++,r.last=t,p.set(e,r),!1)}(t.user.id))return a.NextResponse.json({error:"Too many requests"},{status:429});let r=t.user.id;if(!await i.z.user.findUnique({where:{id:r}}))return a.NextResponse.json({error:"User not found. Please sign in again."},{status:401});let{method:n,status:s,items:o,shipping:u,createdAt:c}=await e.json(),f=o.reduce((e,t)=>e+t.price*t.quantity,0),y=d.OrderStatus.PENDING,g=d.PaymentStatus.PENDING;"pending"===s?(y=d.OrderStatus.PENDING,g=d.PaymentStatus.PENDING):"payment_pending_confirmation"===s&&(y=d.OrderStatus.PENDING,g=d.PaymentStatus.PENDING);let m=await i.z.order.create({data:{orderNumber:`ORD-${Date.now()}-${Math.floor(1e4*Math.random())}`,userId:r,status:y,paymentStatus:g,paymentMethod:n,total:f+0,subtotal:f,shipping:0,currency:"INR",shippingAddress:JSON.parse(JSON.stringify(u)),createdAt:c?new Date(c):new Date,orderItems:{create:o.map(e=>({product:{connect:{id:e.id}},quantity:e.quantity,price:e.price}))}},include:{orderItems:!0}});return a.NextResponse.json({id:m.id},{status:201})}catch(e){return console.error(e),a.NextResponse.json({error:"Failed to create order"},{status:500})}}async function y(e){try{let t=await (0,l.j2)();if(!t?.user?.id)return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=t.user.id,{searchParams:n}=new URL(e.url),s=n.get("id");if(!s)return a.NextResponse.json({error:"Order ID required"},{status:400});let o=await i.z.order.findUnique({where:{id:s},include:{orderItems:!0}});if(!o||o.userId!==r)return a.NextResponse.json({error:"Order not found"},{status:404});return a.NextResponse.json({id:o.id,orderNumber:o.orderNumber,total:o.total,createdAt:o.createdAt,status:o.status,paymentStatus:o.paymentStatus,paymentMethod:o.paymentMethod,orderItems:o.orderItems,shippingAddress:o.shippingAddress})}catch(e){return console.error(e),a.NextResponse.json({error:"Failed to fetch order"},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/order/route",pathname:"/api/order",filename:"route",bundlePath:"app/api/order/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\naazbook\\app\\api\\order\\route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:m,workUnitAsyncStorage:b,serverHooks:j}=g;function _(){return(0,u.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:b})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[4447,2190,5663,8039],()=>r(97268));module.exports=n})();